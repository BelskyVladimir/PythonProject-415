## Настройка и автоматизация ETL-процессов сети продуктовых магазинов. 
<b>Цель проекта:</b> Реализация программного продукта, выполняющего автоматический сбор данных из выгрузок в формате CSV-файлов, а также их консолидацию и загрузку в базу данных. 

<b>Состав проекта</b>
1. Модуль ***extract_and_load.py*** считывает данные из выгрузок в формате CSV-файлов, консолидирует их и записывает в базу данных.
   - Модуль выбирает из папки ***/data*** в рабочей папке проекта все файлы с именами, соответствующими шаблону ***'\*_\*.csv'***.
   - Каждый файл загружается в датафрейм и построчно записывается в таблицу ***sales*** базы данных.
   - Подключение к базе данных производится с помощью модуля ***database_connection.py***.
   - Данные для подключения загружаются из файла ***config.ini***.
2. Модуль ***database_connection.py*** служит для создания подключения к базе данных (построен по шаблону singleton).
3. Модуль ***sales_data_genration.py*** предназначен для создания фейковых выгрузок данных о продажах товаров в формате CSV-файлов.
   - Количество магазинов в сети задано равным 10. Количество касс в каждом магазине задается случайным образом в диапазоне от 1 до 7. Каждый файл содержит информацию о продажах за день по одной контрольно-кассовой машине одного из магазинов.
   - Информация о наименованиях товаров, категории и стоимости загружается из файла ***nomenclature.txt*** в виде словаря в формате json-строки.
   - Количество позиций в чеке и количество товара по каждой позиции определяется случайным образом.
   - Размер скидки по каждой позиции определяется в зависимости от количества по этой позиции: от 5 штук - 5%, от 3 штук - 3%. 
4. Модуль ***create_nomenclature.py*** позволяет создать и сохранить в файл ***nomenclature.txt*** информацию о товарах в виде словаря в формате json-строки.
5. Файлы ***start_generation_data.bat*** и ***start_extract_and_load_data.bat*** содержат пути до интерпретатора Python в виртуальном окружении и до исполняемых модулей и предназначены для автоматического запуска ETL-процессов по расписанию.

<b>Как запустить проект на своем компьютер.</b>

<u>На Windows</u>
1. Установка Python
- ***Win + R*** # Открыть диалоговое окно "Выполнить"
- ***cmd*** # Открыть командную строку
- ***python –version*** Проверка версии установленного Python
- Для установки Python перейдите на официальный сайт https://www.python.org/downloads/ и загрузите версию Python для Windows
- После скачивания запустите мастер установки Python и следуйте его инструкциям
- Пакет виртуального окружения venv является частью стандартной библиотеки Python 3 и поставляется вместе с интерпретатором. 
2. Установка пакетного менеджера Pip (в версиях Python 2.7.9 (и выше) или Python 3.4 (и выше), PIP устанавливается вместе с Python по умолчанию)
- ***pip help*** # Если Pip не установлен, то появится сообщение "pip не является внутренней или внешней командой, исполняемой программой или пакетным файлом"
- Как установить пакетный менеджер Pip можно прочитать на официальном сайте https://pip.pypa.io/en/latest/installation/
3. Установка системы контроля версий Git
- Для установки системы контроля версий Git перейдите на официальный сайт https://git-scm.com/ и загрузите версию для Windows
- После скачивания запустите мастер установки Git и следуйте его инструкциям
4. Установка PostgreSQL 
- Для установки PostgreSQL перейдите на официальный сайт https://www.postgresql.org/download/windows/ и загрузите установочный файл
- Запустите мастер установки и следуйте его инструкциям
- ***cd C:\Program Files\PostgreSQL\11\bin*** # переход в командной строке в директорию bin, в которой находятся основные файлы управления PostgreSQL
- ***createdb -h localhost -p 5432 -U postgres chain_of_grosere_stores*** # создание базы данных chain_of_grosere_stores (необходимо ввести пароль суперпользователя postgres)
5. Клонирование проекта с удаленного репозитория
- ***cd*** # переход в домашнюю директорию пользователя (в которую будет клонироваться проект)
- ***git clone https://github.com/BelskyVladimir/PythonProject-415*** # клонирование проекта из удаленного репозитория в текущую директорию
- ***cd PythonProject415*** # переход в директорию PythonProject415
6. Создание виртуального окружения
- ***python -m venv venv*** # создание виртуального окружения
- ***venv/scripts/activate*** # активация виртуального окружения
- ***pip install -r requirements.txt*** # установка в виртуальное окружение библиотек из списка
7. Внесение изменений в файлы config.ini, start_generation_data.bat и start_extract_and_load_data.bat с помощью текстового редактора
- Измените данные подключения к базе данных в файле config.ini в соответствии вашими настройками
- Измените пути к интерпретатору Python  виртуальном окружении и запускаемому модулю в файле start_generation_data.bat
- Измените пути к интерпретатору Python  виртуальном окружении и запускаемому модулю в файле start_extract_and_load_data.bat
8. Настройка автоматического запуска модулей по расписанию
- Откройте с помощью меню ПУСК планировщик заданий windows
- В меню "Действия" выберите "Создать задачу"
- Дайте задаче имя и заполните описание (по желанию)
- Перейдите на вкладку "Триггеры", нажмите "Создать..." и выберите параметры расписания работы модуля
- Перейдите на вкладку "Действия", нажмите "Создать..." и выберите в "Обзор..." в паке с проектом файл start_generation_data.bat
- Сохраните
- Повторите все действия для файла start_extract_and_load_data.bat

<u>На Linux (Ubuntu, Debian)</u>
- ***python -version***    # проверка установленной версии Python 2
- ***python3 -version***   # проверка установленной версии Python 3
- ***sudo apt update***    # установка обновлений библиотек
- ***sudo apt install python3***   # установка Python3
- ***pip freeze***         # проверка установленного пакетного менеджера Pip (вывод списка установленных библиотек)
- ***sudo apt python3-pip***   # установка пакетного меджера Pip
- ***sudo apt install python3-venv***   # установка виртуального окружения
- ***sudo apt-get install git*** # установка системы контроля версий Git
- ***sudo apt-get install postgresql postgresql-contrib*** # установка PostgreSQL с автоматическим созданием 
- ***sudo su - postgres***  # изменение пользователя на postgres
- ***psql*** # запуск PostgreSQL от имени пользователя postgres
- ***alter user postgres with password 'new_password';***  # задание пароля пользователя postgres
- ***create database chain_of_grosere_stores;*** # создание базы данных chain_of_grosere_stores
- ***\q*** # выход из PostgreSQL
- ***exit*** # возвращение к предыдущему пользователю
- ***cd*** # переход в домашнюю директорию пользователя (в которую будет клонироваться проект)
- ***git clone https://github.com/BelskyVladimir/PythonProject-415*** # клонирование проекта из удаленного репозитория в текущую директорию
- ***cd PythonProject415*** # переход в директорию PythonProject415
- ***python3 -m venv venv*** # создание виртуального окружения в директории с проектом
- ***source venv/bin/activate*** # активация виртуального окружения
- ***pip install -r requirements.txt*** # установка в виртуальное окружение библиотек из списка
- ***EDITOR=nano crontab-e*** # редактирование нового задания в планировщике заданий crontab
- ***# Генерация фейковых выгрузок.*** # название первого задания
- ***01 20 \* \* \* /home/PythonProject415/sales_data_generation.py***  # запуск модуля sales_data_generation.py каждый день в 20 часов 01 минуту
- ***# Сбор данных из выгрузок и загрузка их в базу данных.*** # название второго задания
- ***31 20 \* \* \* /home/PythonProject415/extract_and_load.py***  # запуск модуля extract_and_load.py каждый день в 20 часов 31 минуту
- ***Ctrl+S*** # Сохранить изменения в файле
- ***Ctrl+X*** # Выйти из редактора
- Не забудьте изменить данные для подключения к базе данных в файле config.ini

